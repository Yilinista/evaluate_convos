# LLM-Human Agreement Analysis

This directory contains comprehensive analysis of agreement between LLM and human evaluators on empathy ratings, organized by analysis approach and data scope.

## 📁 Directory Structure

```
llm_human_agreement/
├── README.md                           # This file
├── data/                              # Raw evaluation data
│   ├── Empathy Evaluation - Set 1.csv # Human ratings for 28 conversations
│   └── Empathy Evaluation - Set 2.csv # Human ratings for 27 conversations
│
└── analysis/                          # Analysis results organized by approach
    ├── original_set1_only/            # 🟡 ORIGINAL: Set 1 only, no majority voting
    ├── full_dataset_majority/         # 🟢 FINAL: All 55 conversations, majority voting
    └── comparative_analysis/          # 📊 COMPARISONS: Side-by-side analyses
```

## 🔍 Analysis Categories

### 🟡 Original Analysis (`original_set1_only/`)
**What**: Initial analysis from the first report
- **Data**: Set 1 only (28 conversations)  
- **Method**: Individual human ratings (no majority voting)
- **Key Result**: Spearman ρ = 0.325 (dimension average)

**Files:**
- `llm_human_agreement_analysis.py` - Original analysis script
- `llm_human_agreement_summary.csv` - Results summary
- `llm_human_agreement_analysis.png` - Visualization

### 🔵 Full Dataset Individual (Baseline)
**What**: Complete data without majority voting (for comparison baseline)
- **Data**: Set 1 + Set 2 (55 conversations total)
- **Method**: Individual human ratings (all evaluator responses used separately)
- **Key Result**: Spearman ρ = 0.174 (dimension average), 0.108 (overall)

**Note**: This is generated by comparative analysis scripts (no separate directory).

### 🟢 Final Analysis (`full_dataset_majority/`)
**What**: Siyan's requested analysis with majority voting
- **Data**: Set 1 + Set 2 (55 conversations total)
- **Method**: Majority voting to resolve human rater disagreements
- **Key Result**: Spearman ρ = 0.332 (dimension average), 0.171 (overall)

**Files:**
- `llm_human_agreement_with_majority_voting.py` - Majority voting implementation
- `llm_human_agreement_majority_voting_summary.csv` - Results with majority voting
- `llm_human_agreement_majority_voting.png` - Visualization with voting analysis

### 📊 Comparative Analysis (`comparative_analysis/`)
**What**: Side-by-side comparisons and comprehensive analysis
- **Purpose**: Understand the impact of majority voting and dataset expansion
- **Comparisons**: Set 1 vs Set 2, Individual vs Majority, Original vs Current

**Files:**
- `analyze_sets_separately.py` - Set 1 vs Set 2 analysis
- `comprehensive_analysis.py` - Both correlation calculation methods
- `create_improvement_visualization.py` - Improvement charts
- `set_comparison_summary.csv` - Set-by-set comparison results
- `comprehensive_correlation_comparison.csv` - Method comparison results
- `set_comparison_analysis.png` - Set 1 vs Set 2 visualization
- `majority_voting_improvements.png` - Comprehensive improvement charts
- `simple_before_after.png` - Clean before/after comparison

## 📈 Key Findings Summary

| Analysis Type | Data Scope | Method | Spearman ρ (Dim Avg) | Spearman ρ (Overall) | Notes |
|---------------|------------|--------|---------------------|---------------------|-------|
| 🟡 **Original** | Set 1 (28) | Individual | **0.325** | ~0.160 | Initial report baseline |
| 🔵 **Baseline** | Both Sets (55) | Individual | **0.174** | **0.108** | Lower due to full dataset |
| 🟢 **Final** | Both Sets (55) | Majority Voting | **0.332** | **0.171** | **Siyan's requested analysis** |

### Impact of Majority Voting:
- **Dimension Average**: 0.174 → 0.332 (**+91% improvement**)
- **Overall Correlation**: 0.108 → 0.171 (**+58% improvement**)
- **Recovery**: Final result (0.332) matches original report level (0.325)

## 🎯 For Siyan's Research

**Recommended reporting:**
```
"After applying majority voting to resolve human rater disagreements across 55 conversations:
• Dimension-wise average Spearman ρ: 0.332 (improved from 0.174, +91%)
• Overall Spearman ρ: 0.171 (p < 0.071, improved from 0.108, +58%)
• Absolute agreement: 42.9%
• Within-one agreement: 100.0%
• Total conversations: 55 (Set 1: 28, Set 2: 27)"
```

## 🔧 Usage Instructions

### Run Original Analysis (Set 1 only):
```bash
cd analysis/original_set1_only/
python llm_human_agreement_analysis.py
```

### Run Final Analysis (Majority Voting):
```bash
cd analysis/full_dataset_majority/
python llm_human_agreement_with_majority_voting.py
```

### Run Comparative Analysis:
```bash
cd analysis/comparative_analysis/
python analyze_sets_separately.py          # Set 1 vs Set 2
python comprehensive_analysis.py           # Both correlation methods
python create_improvement_visualization.py # Improvement charts
```

## 📊 Visualization Summary

### Original Visualizations:
- `original_set1_only/llm_human_agreement_analysis.png` - Basic agreement analysis

### Final Visualizations:
- `full_dataset_majority/llm_human_agreement_majority_voting.png` - Majority voting analysis

### Comparative Visualizations:
- `comparative_analysis/set_comparison_analysis.png` - Set 1 vs Set 2 detailed comparison
- `comparative_analysis/majority_voting_improvements.png` - Comprehensive improvement charts
- `comparative_analysis/simple_before_after.png` - Clean before/after summary

## 🔬 Methodology Notes

### Two Correlation Calculation Methods:
1. **Dimension Average**: Calculate Spearman correlation for each empathy dimension separately, then average
   - More intuitive for multi-dimensional evaluation
   - Matches original reporting style (0.325)

2. **Overall Correlation**: Combine all dimension scores and calculate single correlation
   - More statistically rigorous
   - Conservative estimate of true correlation

### Majority Voting Process:
- Collects all human evaluator ratings for each conversation-dimension pair
- Uses most frequent rating as consensus (ties handled appropriately)
- Resolves ~75-80% of evaluator disagreements
- Significantly improves LLM-human correlation metrics

## 📝 Research Context

This analysis addresses Siyan's request to:
1. ✅ Apply majority voting to resolve human rater disagreements
2. ✅ Use complete dataset (55 conversations from both Google Forms)
3. ✅ Re-calculate agreement metrics with improved data quality

The results show that majority voting successfully recovers correlation performance to the level of the original report while using the complete dataset.